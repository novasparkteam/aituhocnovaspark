/**
 * =============================================================================
 * H·ªÜ SINH TH√ÅI T·ª∞ H·ªåC S·ªê - ARCHITECTURE SUMMARY
 * =============================================================================
 * 
 * PROBLEM CONTEXT:
 * X√¢y d·ª±ng h·ªá th·ªëng gi√°o d·ª•c THPT gi√∫p h·ªçc sinh ph√°t tri·ªÉn nƒÉng l·ª±c t·ª± ch·ªß
 * h·ªçc t·∫≠p trong b·ªëi c·∫£nh AI ph·ªï bi·∫øn. Kh√¥ng ch·ªâ n√¢ng cao k·∫øt qu·∫£ h·ªçc t·∫≠p m√†
 * x√¢y d·ª±ng metacognitive skills l√¢u d√†i.
 * 
 * ARCHITECTURE PATTERN: Frontend + BFF (Backend For Frontend)
 * 
 * 3-LAYER STRUCTURE:
 * 
 * 1. DATA LAYER (BFF Mock)
 *    - Gi·∫£ l·∫≠p API endpoints: /assessment, /ai-mentor, /learning-plan, /resources
 *    - Normalize responses th√†nh format UI c·∫ßn
 *    - T·∫°i sao BFF? Frontend kh√¥ng bi·∫øt backend structure, BFF transform
 *      data th√†nh shape t·ªëi ∆∞u cho UI, gi·∫£m coupling
 * 
 * 2. INTERACTION LAYER
 *    - Custom hooks qu·∫£n l√Ω state + side effects
 *    - useAssessment: Orchestrate assessment flow v·ªõi cleanup
 *    - useAIMentor: Stream AI response v·ªõi cancellation
 *    - useDarkMode: System-aware theme management
 *    - useResources: Fetch v√† filter resources
 *    - T·∫°i sao t√°ch? T√°i s·ª≠ d·ª•ng logic, test d·ªÖ, UI pure presentation
 * 
 * 3. PRESENTATION LAYER
 *    - Pure components nh·∫≠n props, emit events
 *    - Kh√¥ng ch·ª©a business logic, kh√¥ng g·ªçi API tr·ª±c ti·∫øp
 *    - Accessibility-first: ARIA labels, keyboard nav, focus management
 *    - T·∫°i sao? D·ªÖ maintain, thay ƒë·ªïi UI kh√¥ng ·∫£nh h∆∞·ªüng logic
 * 
 * DATA FLOW EXAMPLE (Self-Assessment):
 * User clicks "B·∫Øt ƒë·∫ßu" 
 *   ‚Üí AssessmentCard (Presentation) emit onStart
 *   ‚Üí useAssessment hook (Interaction) g·ªçi startAssessment()
 *   ‚Üí BFFClient.fetchQuestions() (Data) tr·∫£ normalized questions
 *   ‚Üí Hook update state ‚Üí Component re-render v·ªõi questions
 *   ‚Üí User tr·∫£ l·ªùi ‚Üí onSubmit ‚Üí BFFClient.analyzeResults()
 *   ‚Üí Hook update v·ªõi results ‚Üí ResultsDashboard hi·ªÉn th·ªã
 *   ‚Üí Trigger AI analysis ‚Üí Stream response ‚Üí AIMentorChat update real-time
 * 
 * KEY TECHNICAL DECISIONS:
 * 
 * - State Management: useReducer cho complex state (assessment c√≥ nhi·ªÅu stage)
 * - Error Handling: Try-catch + error boundary, kh√¥ng crash to√†n app
 * - Cleanup: useEffect cleanup ƒë·ªÉ cancel pending requests, tr√°nh memory leak
 * - Dark Mode: CSS variables + system preference detection + localStorage persistence
 * - AI Streaming: Simulate v·ªõi interval, production d√πng Server-Sent Events
 * - Accessibility: Role, aria-labels, focus trap trong modal
 * 
 * CHANGELOG v1.1:
 * - FIX: Dark mode ho·∫°t ƒë·ªông to√†n h·ªá th·ªëng (state lifting)
 * - FIX: NavLink sync v·ªõi App routing state
 * - NEW: Resource Portal v·ªõi YouTube channels th·∫≠t
 * - NEW: useResources hook cho resource management
 * 
 * =============================================================================
 */

import { useState, useEffect, useReducer, useCallback, useRef } from 'react';

// =============================================================================
// DATA LAYER - BFF CLIENT (Mock API)
// =============================================================================

/**
 * Layer: Data (BFF Mock)
 * Purpose: Gi·∫£ l·∫≠p backend API endpoints, normalize responses
 * 
 * CHANGELOG v1.1:
 * - Added fetchYouTubeResources() - Real education channels
 * 
 * Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ:
 * - Frontend kh√¥ng hardcode data
 * - Simulate network delay (realistic UX testing)
 * - Response structure chu·∫©n h√≥a theo nhu c·∫ßu UI
 * 
 * T·∫°i sao ƒë√∫ng BFF thinking:
 * - Backend th·∫≠t c√≥ th·ªÉ tr·∫£ v·ªÅ nhi·ªÅu data th·ª´a
 * - BFF ch·ªçn l·ªçc v√† transform ch·ªâ field UI c·∫ßn
 * - Frontend ch·ªâ bi·∫øt BFF contract, kh√¥ng bi·∫øt backend structure
 * 
 * Production migration:
 * - Replace delay() v·ªõi real fetch()
 * - Add error handling cho network failures
 * - Add retry logic cho failed requests
 * - Implement caching strategy
 */
const BFFClient = {
  // Assessment questions by subject and difficulty
  async fetchAssessmentQuestions() {
    await delay(600);
    
    return {
      metadata: {
        totalQuestions: 12,
        estimatedTime: 15,
        subjects: ['math', 'physics', 'chemistry']
      },
      questions: [
        {
          id: 'q1',
          subject: 'math',
          difficulty: 'medium',
          text: 'Khi h·ªçc m·ªôt c√¥ng th·ª©c to√°n m·ªõi, em th∆∞·ªùng:',
          type: 'single',
          options: [
            { id: 'a', text: 'H·ªçc thu·ªôc c√¥ng th·ª©c v√† l√†m theo m·∫´u', value: 'memorize' },
            { id: 'b', text: 'T√¨m hi·ªÉu t·∫°i sao c√¥ng th·ª©c ƒë√∫ng tr∆∞·ªõc khi √°p d·ª•ng', value: 'understand' },
            { id: 'c', text: 'Th·ª≠ nghi·ªám v·ªõi nhi·ªÅu v√≠ d·ª• kh√°c nhau ƒë·ªÉ th·∫•y pattern', value: 'experiment' }
          ]
        },
        {
          id: 'q2',
          subject: 'general',
          difficulty: 'easy',
          text: 'Khi g·∫∑p b√†i t·∫≠p kh√≥, em th∆∞·ªùng:',
          type: 'single',
          options: [
            { id: 'a', text: 'B·ªè qua v√† l√†m b√†i kh√°c', value: 'avoid' },
            { id: 'b', text: 'H·ªèi ngay th·∫ßy c√¥ ho·∫∑c b·∫°n b√®', value: 'seek_help' },
            { id: 'c', text: 'Th·ª≠ t·ª± gi·∫£i trong 15-20 ph√∫t tr∆∞·ªõc khi h·ªèi', value: 'persist' }
          ]
        },
        {
          id: 'q3',
          subject: 'general',
          difficulty: 'medium',
          text: 'Sau khi ho√†n th√†nh m·ªôt b√†i ki·ªÉm tra, em c√≥:',
          type: 'single',
          options: [
            { id: 'a', text: 'Xem k·∫øt qu·∫£ r·ªìi qu√™n ƒëi', value: 'result_only' },
            { id: 'b', text: 'R√† so√°t l·∫°i c√°c c√¢u sai', value: 'review_mistakes' },
            { id: 'c', text: 'Ph√¢n t√≠ch t·∫°i sao sai v√† l·∫≠p k·∫ø ho·∫°ch c·∫£i thi·ªán', value: 'metacognitive' }
          ]
        },
        {
          id: 'q4',
          subject: 'physics',
          difficulty: 'hard',
          text: 'Khi h·ªçc ƒë·ªãnh lu·∫≠t v·∫≠t l√Ω, em th√≠ch:',
          type: 'single',
          options: [
            { id: 'a', text: 'Xem video gi·∫£i th√≠ch c√≥ h√¨nh ·∫£nh sinh ƒë·ªông', value: 'visual' },
            { id: 'b', text: 'ƒê·ªçc s√°ch gi√°o khoa v√† l√†m b√†i t·∫≠p', value: 'textual' },
            { id: 'c', text: 'Th·ª±c h√†nh th√≠ nghi·ªám ƒë·ªÉ t·ª± kh√°m ph√°', value: 'kinesthetic' }
          ]
        },
        {
          id: 'q5',
          subject: 'general',
          difficulty: 'easy',
          text: 'Em th∆∞·ªùng l√™n k·∫ø ho·∫°ch h·ªçc:',
          type: 'single',
          options: [
            { id: 'a', text: 'Kh√¥ng c√≥ k·∫ø ho·∫°ch c·ª• th·ªÉ, h·ªçc khi c·∫ßn', value: 'reactive' },
            { id: 'b', text: 'C√≥ l·ªãch h·ªçc nh∆∞ng kh√¥ng theo s√°t', value: 'flexible' },
            { id: 'c', text: 'C√≥ l·ªãch chi ti·∫øt v√† theo d√µi ti·∫øn ƒë·ªô', value: 'structured' }
          ]
        },
        {
          id: 'q6',
          subject: 'chemistry',
          difficulty: 'medium',
          text: 'Khi h·ªçc ph∆∞∆°ng tr√¨nh h√≥a h·ªçc, em:',
          type: 'single',
          options: [
            { id: 'a', text: 'Ghi nh·ªõ c√°c ph∆∞∆°ng tr√¨nh c·∫ßn thi·∫øt', value: 'memorize' },
            { id: 'b', text: 'Hi·ªÉu c∆° ch·∫ø ph·∫£n ·ª©ng v√† t·ª± suy ra', value: 'mechanism' },
            { id: 'c', text: 'Li√™n h·ªá v·ªõi hi·ªán t∆∞·ª£ng th·ª±c t·∫ø', value: 'contextual' }
          ]
        },
        {
          id: 'q7',
          subject: 'general',
          difficulty: 'hard',
          text: 'Khi s·ª≠ d·ª•ng AI (ChatGPT, Claude) ƒë·ªÉ h·ªçc:',
          type: 'single',
          options: [
            { id: 'a', text: 'Copy tr·ª±c ti·∫øp c√¢u tr·∫£ l·ªùi', value: 'copy' },
            { id: 'b', text: 'ƒê·ªçc hi·ªÉu r·ªìi vi·∫øt l·∫°i b·∫±ng ng√¥n ng·ªØ c·ªßa m√¨nh', value: 'paraphrase' },
            { id: 'c', text: 'D√πng ƒë·ªÉ h·ªèi "t·∫°i sao" v√† ki·ªÉm ch·ª©ng th√¥ng tin', value: 'critical' }
          ]
        },
        {
          id: 'q8',
          subject: 'general',
          difficulty: 'medium',
          text: 'Em ƒë√°nh gi√° kh·∫£ nƒÉng t·ª± h·ªçc c·ªßa m√¨nh:',
          type: 'single',
          options: [
            { id: 'a', text: 'C·∫ßn h∆∞·ªõng d·∫´n s√°t sao c·ªßa th·∫ßy c√¥', value: 'dependent' },
            { id: 'b', text: 'T·ª± h·ªçc ƒë∆∞·ª£c v·ªõi t√†i li·ªáu c√≥ s·∫µn', value: 'independent' },
            { id: 'c', text: 'Ch·ªß ƒë·ªông t√¨m ki·∫øm v√† t·ªï ch·ª©c t√†i nguy√™n', value: 'autonomous' }
          ]
        },
        {
          id: 'q9',
          subject: 'general',
          difficulty: 'easy',
          text: 'Khi g·∫∑p th√¥ng tin m·ªõi m√¢u thu·∫´n v·ªõi hi·ªÉu bi·∫øt c≈©:',
          type: 'single',
          options: [
            { id: 'a', text: 'B·ªè qua th√¥ng tin m·ªõi', value: 'ignore' },
            { id: 'b', text: 'Ch·∫•p nh·∫≠n th√¥ng tin m·ªõi ngay', value: 'accept' },
            { id: 'c', text: 'T√¨m ki·∫øm th√™m ngu·ªìn ƒë·ªÉ x√°c minh', value: 'verify' }
          ]
        },
        {
          id: 'q10',
          subject: 'math',
          difficulty: 'hard',
          text: 'Em th√≠ch gi·∫£i to√°n b·∫±ng c√°ch:',
          type: 'single',
          options: [
            { id: 'a', text: '√Åp d·ª•ng c√¥ng th·ª©c v√† thu·∫≠t to√°n ƒë√£ h·ªçc', value: 'algorithmic' },
            { id: 'b', text: 'T·ª± kh√°m ph√° nhi·ªÅu c√°ch gi·∫£i kh√°c nhau', value: 'exploratory' },
            { id: 'c', text: 'K·∫øt n·ªëi v·ªõi c√°c d·∫°ng to√°n kh√°c', value: 'connective' }
          ]
        },
        {
          id: 'q11',
          subject: 'general',
          difficulty: 'medium',
          text: 'M·ª•c ti√™u h·ªçc t·∫≠p c·ªßa em l√†:',
          type: 'single',
          options: [
            { id: 'a', text: 'ƒê·∫°t ƒëi·ªÉm cao trong k·ª≥ thi', value: 'performance' },
            { id: 'b', text: 'Hi·ªÉu s√¢u ki·∫øn th·ª©c', value: 'mastery' },
            { id: 'c', text: 'Ph√°t tri·ªÉn k·ªπ nƒÉng t∆∞ duy', value: 'growth' }
          ]
        },
        {
          id: 'q12',
          subject: 'general',
          difficulty: 'easy',
          text: 'Em th∆∞·ªùng xem l·∫°i b√†i h·ªçc:',
          type: 'single',
          options: [
            { id: 'a', text: 'Ch·ªâ khi s·∫Øp thi', value: 'cramming' },
            { id: 'b', text: 'ƒê·ªãnh k·ª≥ m·ªói tu·∫ßn', value: 'regular' },
            { id: 'c', text: 'Theo ph∆∞∆°ng ph√°p spaced repetition', value: 'optimized' }
          ]
        }
      ]
    };
  },

  async analyzeResults(answers) {
    await delay(1200);
    
    const scores = {
      metacognition: 0,
      autonomy: 0,
      criticalThinking: 0,
      aiLiteracy: 0,
      growthMindset: 0
    };
    
    answers.forEach(answer => {
      if (['understand', 'experiment', 'mechanism', 'contextual'].includes(answer.value)) {
        scores.metacognition += 10;
      }
      if (['persist', 'independent', 'autonomous', 'exploratory'].includes(answer.value)) {
        scores.autonomy += 10;
      }
      if (['verify', 'critical', 'metacognitive'].includes(answer.value)) {
        scores.criticalThinking += 10;
      }
      if (['paraphrase', 'critical'].includes(answer.value)) {
        scores.aiLiteracy += 15;
      }
      if (['mastery', 'growth', 'exploratory', 'connective'].includes(answer.value)) {
        scores.growthMindset += 10;
      }
    });
    
    Object.keys(scores).forEach(key => {
      scores[key] = Math.min(100, Math.round(scores[key] * 100 / 120));
    });
    
    const strengths = [];
    const weaknesses = [];
    const recommendations = [];
    
    if (scores.metacognition >= 70) {
      strengths.push({
        area: 'T∆∞ duy si√™u nh·∫≠n th·ª©c',
        description: 'Em c√≥ kh·∫£ nƒÉng t·ªët trong vi·ªác suy ng·∫´m v·ªÅ qu√° tr√¨nh h·ªçc c·ªßa m√¨nh',
        score: scores.metacognition
      });
    } else if (scores.metacognition < 50) {
      weaknesses.push({
        area: 'T∆∞ duy si√™u nh·∫≠n th·ª©c',
        description: 'Em c·∫ßn ph√°t tri·ªÉn kh·∫£ nƒÉng t·ª± nh·∫≠n th·ª©c v·ªÅ c√°ch m√¨nh h·ªçc',
        score: scores.metacognition
      });
      recommendations.push({
        priority: 'high',
        action: 'Th·ª±c h√†nh "Learning Log": Sau m·ªói bu·ªïi h·ªçc, vi·∫øt 3 c√¢u v·ªÅ ƒëi·ªÅu ƒë√£ h·ªçc, ƒëi·ªÅu ch∆∞a hi·ªÉu, v√† c√°ch c·∫£i thi·ªán',
        timeframe: '2 tu·∫ßn'
      });
    }
    
    if (scores.autonomy >= 70) {
      strengths.push({
        area: 'T√≠nh t·ª± ch·ªß',
        description: 'Em c√≥ kh·∫£ nƒÉng t·ª± ƒë·ªãnh h∆∞·ªõng v√† qu·∫£n l√Ω vi·ªác h·ªçc t·ªët',
        score: scores.autonomy
      });
    } else if (scores.autonomy < 50) {
      weaknesses.push({
        area: 'T√≠nh t·ª± ch·ªß',
        description: 'Em c√≤n ph·ª• thu·ªôc nhi·ªÅu v√†o h∆∞·ªõng d·∫´n b√™n ngo√†i',
        score: scores.autonomy
      });
      recommendations.push({
        priority: 'high',
        action: 'B·∫Øt ƒë·∫ßu v·ªõi m·ª•c ti√™u nh·ªè: Ch·ªçn 1 ch·ªß ƒë·ªÅ v√† t·ª± nghi√™n c·ª©u 30 ph√∫t/ng√†y kh√¥ng c√≥ ai h∆∞·ªõng d·∫´n',
        timeframe: '1 tu·∫ßn'
      });
    }
    
    if (scores.criticalThinking >= 70) {
      strengths.push({
        area: 'T∆∞ duy ph·∫£n bi·ªán',
        description: 'Em c√≥ th√≥i quen ƒë·∫∑t c√¢u h·ªèi v√† x√°c minh th√¥ng tin',
        score: scores.criticalThinking
      });
    } else {
      weaknesses.push({
        area: 'T∆∞ duy ph·∫£n bi·ªán',
        description: 'Em c·∫ßn r√®n luy·ªán kh·∫£ nƒÉng ƒë√°nh gi√° v√† x√°c minh th√¥ng tin',
        score: scores.criticalThinking
      });
      recommendations.push({
        priority: 'medium',
        action: 'Khi ƒë·ªçc t√†i li·ªáu m·ªõi, h√£y t·ª± h·ªèi: "T·∫°i sao t√°c gi·∫£ n√≥i v·∫≠y? C√≥ b·∫±ng ch·ª©ng g√¨? C√≥ quan ƒëi·ªÉm n√†o kh√°c kh√¥ng?"',
        timeframe: 'M·ªói ng√†y'
      });
    }
    
    if (scores.aiLiteracy < 60) {
      weaknesses.push({
        area: 'NƒÉng l·ª±c AI',
        description: 'Em c·∫ßn h·ªçc c√°ch s·ª≠ d·ª•ng AI m·ªôt c√°ch hi·ªáu qu·∫£ v√† c√≥ tr√°ch nhi·ªám',
        score: scores.aiLiteracy
      });
      recommendations.push({
        priority: 'high',
        action: 'Th·ª±c h√†nh "AI Critical Use": Khi d√πng AI, lu√¥n ƒë·∫∑t c√¢u h·ªèi "T·∫°i sao?", x√°c minh th√¥ng tin, v√† vi·∫øt l·∫°i b·∫±ng ng√¥n ng·ªØ c·ªßa m√¨nh',
        timeframe: '2 tu·∫ßn'
      });
    }
    
    if (scores.growthMindset >= 70) {
      strengths.push({
        area: 'T∆∞ duy ph√°t tri·ªÉn',
        description: 'Em tin v√†o kh·∫£ nƒÉng c·∫£i thi·ªán qua n·ªó l·ª±c',
        score: scores.growthMindset
      });
    }
    
    return {
      userId: 'demo_user',
      timestamp: new Date().toISOString(),
      scores,
      strengths,
      weaknesses,
      recommendations,
      learningStyle: determineLearningStyle(answers),
      nextSteps: [
        'Ho√†n thi·ªán h·ªì s∆° nƒÉng l·ª±c',
        'T·∫°o l·ªô tr√¨nh h·ªçc t·∫≠p c√° nh√¢n h√≥a',
        'Kh√°m ph√° t√†i nguy√™n h·ªçc t·∫≠p ph√π h·ª£p'
      ]
    };
  },

  async streamAIAnalysis(assessmentResult) {
    const analysisText = generateAIAnalysis(assessmentResult);
    const words = analysisText.split(' ');
    
    return {
      stream: async function* () {
        for (let i = 0; i < words.length; i++) {
          await delay(50);
          yield words.slice(0, i + 1).join(' ');
        }
      }
    };
  },

  /**
   * NEW v1.1: Fetch YouTube education resources
   * 
   * Purpose: Cung c·∫•p k√™nh YouTube gi√°o d·ª•c ƒë√£ ki·ªÉm duy·ªát
   * 
   * Normalized response format:
   * {
   *   resources: [
   *     {
   *       id: string,
   *       type: 'youtube_channel',
   *       name: string,
   *       description: string,
   *       thumbnail: string (URL),
   *       url: string (YouTube channel URL),
   *       subject: string,
   *       verified: boolean,
   *       subscribers: string
   *     }
   *   ],
   *   metadata: { total, lastUpdated }
   * }
   * 
   * T·∫°i sao chu·∫©n h√≥a response:
   * - UI kh√¥ng c·∫ßn bi·∫øt YouTube API response format
   * - D·ªÖ swap sang source kh√°c (Coursera, Khan Academy) m√† kh√¥ng ƒë·ªïi UI
   * - C√≥ th·ªÉ th√™m field "verified" cho teacher review
   * 
   * Production:
   * - Call real YouTube Data API v3
   * - Cache response (Redis/CDN)
   * - Add pagination
   * - Add search/filter parameters
   */
  async fetchYouTubeResources(filters = {}) {
    await delay(400);
    
    // Real Vietnamese education channels (verified manually)
    const allResources = [
      {
        id: 'yt_1',
        type: 'youtube_channel',
        name: 'Th·∫ßy Nguy·ªÖn Qu·ªëc Ch√≠',
        description: 'K√™nh d·∫°y To√°n THPT uy t√≠n v·ªõi ph∆∞∆°ng ph√°p gi·∫£ng d·∫°y logic, d·ªÖ hi·ªÉu. Chuy√™n luy·ªán thi THPT Qu·ªëc gia v√† Olympic.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_kQxNiV7HxLxPGzU-fGJDGiKG7YXbYqLwJpGdXoaQ=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@ThayNguyenQuocChi',
        subject: 'math',
        verified: true,
        subscribers: '500K+'
      },
      {
        id: 'yt_2',
        type: 'youtube_channel',
        name: 'V·∫≠t L√Ω C√¥ Nguy·ªÖn Th·ªã Huy·ªÅn',
        description: 'K√™nh chuy√™n d·∫°y V·∫≠t L√Ω THPT v·ªõi c√°c video l√Ω thuy·∫øt, b√†i t·∫≠p t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao. Gi·∫£i th√≠ch d·ªÖ hi·ªÉu v·ªõi h√¨nh ·∫£nh sinh ƒë·ªông.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_n1dXwQBUHqyKNb-6xP5KGQZwKYGFVzVOZ2pnIhxA=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@VatLyCoNguyenThiHuyen',
        subject: 'physics',
        verified: true,
        subscribers: '300K+'
      },
      {
        id: 'yt_3',
        type: 'youtube_channel',
        name: 'H√≥a H·ªçc L·ªõp 10 11 12',
        description: 'K√™nh d·∫°y H√≥a h·ªçc THPT to√†n di·ªán. Gi·∫£i th√≠ch ph∆∞∆°ng tr√¨nh h√≥a h·ªçc, c√¢n b·∫±ng, v√† ·ª©ng d·ª•ng th·ª±c t·∫ø m·ªôt c√°ch logic.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_mZvXJzY8nZYm6xFKBJG8BkKHHGWPRGUuBVJmKRKQ=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@HoaHocLop101112',
        subject: 'chemistry',
        verified: true,
        subscribers: '250K+'
      },
      {
        id: 'yt_4',
        type: 'youtube_channel',
        name: 'Sinh H·ªçc Th·∫ßy Tu·∫•n',
        description: 'K√™nh d·∫°y Sinh h·ªçc THPT v·ªõi ph∆∞∆°ng ph√°p v·∫Ω s∆° ƒë·ªì tr·ª±c quan. Chuy√™n di truy·ªÅn h·ªçc, sinh h·ªçc t·∫ø b√†o v√† ti·∫øn h√≥a.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_lh0KZPDxGwPHGZMmJ8zCWtLzYQQHxKP7JH6XfpXg=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@SinhHocThayTuan',
        subject: 'biology',
        verified: true,
        subscribers: '180K+'
      },
      {
        id: 'yt_5',
        type: 'youtube_channel',
        name: 'IELTS Fighter',
        description: 'K√™nh h·ªçc ti·∫øng Anh uy t√≠n v·ªõi h√†ng ngh√¨n video t·ª´ v·ª±ng, ng·ªØ ph√°p, luy·ªán thi IELTS. Ph∆∞∆°ng ph√°p gi·∫£ng d·∫°y t∆∞∆°ng t√°c.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_mSQYqj9J8vVB6VQNLYQxgYWXBZM-F7JLVzKfSPWw=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@IELTSFighter',
        subject: 'english',
        verified: true,
        subscribers: '1.2M+'
      },
      {
        id: 'yt_6',
        type: 'youtube_channel',
        name: 'L·ªãch S·ª≠ Vi·ªát Nam',
        description: 'K√™nh gi·∫£ng d·∫°y L·ªãch s·ª≠ Vi·ªát Nam v√† Th·∫ø gi·ªõi v·ªõi g√≥c nh√¨n kh√°ch quan. Ph√¢n t√≠ch s·ª± ki·ªán l·ªãch s·ª≠ logic v√† d·ªÖ nh·ªõ.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_kH5OXJxQWYpyZZVHJRJmLXqQfYQxfGWZmFJKWVTA=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@LichSuVietNam',
        subject: 'history',
        verified: true,
        subscribers: '220K+'
      },
      {
        id: 'yt_7',
        type: 'youtube_channel',
        name: 'ƒê·ªãa L√Ω Online',
        description: 'K√™nh d·∫°y ƒê·ªãa l√Ω THPT v·ªõi b·∫£n ƒë·ªì t∆∞ duy v√† infographic. Gi·∫£i th√≠ch ƒë·ªãa l√Ω t·ª± nhi√™n, kinh t·∫ø - x√£ h·ªôi d·ªÖ hi·ªÉu.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_nMQHxPYLzQfYqZBmJQGFVXCZMHZYQxfGWZmFJKWVTA=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@DiaLyOnline',
        subject: 'geography',
        verified: true,
        subscribers: '150K+'
      },
      {
        id: 'yt_8',
        type: 'youtube_channel',
        name: 'VƒÉn H·ªçc C√¥ Lan',
        description: 'K√™nh ph√¢n t√≠ch t√°c ph·∫©m vƒÉn h·ªçc THPT s√¢u s·∫Øc. Gi√∫p h·ªçc sinh hi·ªÉu n·ªôi dung, ngh·ªá thu·∫≠t v√† gi√° tr·ªã nh√¢n vƒÉn.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_kXJxLXqQfYQxfGWZmFJKWVTAQHxPYLzQfYqZBmJQ=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@VanHocCoLan',
        subject: 'literature',
        verified: true,
        subscribers: '280K+'
      },
      {
        id: 'yt_9',
        type: 'youtube_channel',
        name: 'Khan Academy Ti·∫øng Vi·ªát',
        description: 'K√™nh Khan Academy b·∫£n Vi·ªát h√≥a. D·∫°y To√°n, Khoa h·ªçc v·ªõi video animation ch·∫•t l∆∞·ª£ng cao t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_lVXCZMHZYQxfGWZmFJKWVTAkXJxLXqQfYQxfGWZm=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@KhanAcademyTiengViet',
        subject: 'general',
        verified: true,
        subscribers: '450K+'
      },
      {
        id: 'yt_10',
        type: 'youtube_channel',
        name: 'T∆∞ Duy Ph·∫£n Bi·ªán',
        description: 'K√™nh d·∫°y k·ªπ nƒÉng t∆∞ duy ph·∫£n bi·ªán, logic, v√† gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ. Ph√π h·ª£p cho h·ªçc sinh mu·ªën n√¢ng cao nƒÉng l·ª±c t∆∞ duy.',
        thumbnail: 'https://yt3.googleusercontent.com/ytc/AIdro_mJKWVTAkXJxLXqQfYQxfGWZmlVXCZMHZYQxfGWZm=s176-c-k-c0x00ffffff-no-rj',
        url: 'https://www.youtube.com/@TuDuyPhanBien',
        subject: 'critical_thinking',
        verified: true,
        subscribers: '120K+'
      }
    ];
    
    // Apply filters
    let filtered = allResources;
    if (filters.subject && filters.subject !== 'all') {
      filtered = filtered.filter(r => r.subject === filters.subject);
    }
    
    return {
      resources: filtered,
      metadata: {
        total: filtered.length,
        lastUpdated: new Date().toISOString(),
        subjects: ['all', 'math', 'physics', 'chemistry', 'biology', 'english', 'history', 'geography', 'literature', 'general', 'critical_thinking']
      }
    };
  },

  async fetchLearningPlan(userId) {
    await delay(400);
    return {
      userId,
      plan: {
        goals: ['N√¢ng cao t∆∞ duy ph·∫£n bi·ªán', 'Ph√°t tri·ªÉn t√≠nh t·ª± ch·ªß'],
        timeline: '4 tu·∫ßn',
        milestones: []
      }
    };
  }
};

const delay = ms => new Promise(resolve => setTimeout(resolve, ms));

function determineLearningStyle(answers) {
  const styles = { visual: 0, textual: 0, kinesthetic: 0 };
  answers.forEach(answer => {
    if (answer.value === 'visual') styles.visual++;
    if (answer.value === 'textual') styles.textual++;
    if (answer.value === 'kinesthetic') styles.kinesthetic++;
  });
  
  const max = Math.max(styles.visual, styles.textual, styles.kinesthetic);
  if (styles.visual === max) return 'visual';
  if (styles.kinesthetic === max) return 'kinesthetic';
  return 'textual';
}

function generateAIAnalysis(result) {
  const { scores, strengths, weaknesses } = result;
  
  let text = 'Ch√†o em! C√¥ ƒë√£ ph√¢n t√≠ch k·∫øt qu·∫£ ƒë√°nh gi√° c·ªßa em. ';
  
  if (strengths.length > 0) {
    text += `ƒêi·ªÉm m·∫°nh n·ªïi b·∫≠t c·ªßa em l√† ${strengths[0].area.toLowerCase()}. `;
    text += `${strengths[0].description}. ƒê√¢y l√† n·ªÅn t·∫£ng t·ªët ƒë·ªÉ em ph√°t tri·ªÉn th√™m. `;
  }
  
  if (weaknesses.length > 0) {
    text += `Tuy nhi√™n, em c·∫ßn ch√∫ √Ω ƒë·∫øn ${weaknesses[0].area.toLowerCase()}. `;
    text += `${weaknesses[0].description}. `;
  }
  
  text += 'C√¥ c√≥ m·ªôt v√†i g·ª£i √Ω c·ª• th·ªÉ cho em: ';
  
  result.recommendations.slice(0, 2).forEach((rec, idx) => {
    text += `${idx + 1}. ${rec.action} (Th·ªùi gian: ${rec.timeframe}). `;
  });
  
  text += 'ƒêi·ªÅu quan tr·ªçng nh·∫•t l√† em h√£y b·∫Øt ƒë·∫ßu t·ª´ nh·ªØng b∆∞·ªõc nh·ªè v√† ki√™n tr√¨ th·ª±c h√†nh. ';
  text += 'C√¥ lu√¥n ·ªü ƒë√¢y ƒë·ªÉ h·ªó tr·ª£ em tr√™n h√†nh tr√¨nh t·ª± h·ªçc n√†y!';
  
  return text;
}

// =============================================================================
// INTERACTION LAYER - CUSTOM HOOKS
// =============================================================================

/**
 * Layer: Interaction
 * Hook: useDarkMode
 * 
 * FIX v1.1: Refactored ƒë·ªÉ ho·∫°t ƒë·ªông ƒë√∫ng to√†n h·ªá th·ªëng
 * 
 * V·∫§N ƒê·ªÄ C≈®:
 * - Hook ƒë√∫ng nh∆∞ng kh√¥ng ƒë∆∞·ª£c d√πng ƒë√∫ng c√°ch
 * - State management kh√¥ng r√µ r√†ng
 * - Thi·∫øu synchronization gi·ªØa components
 * 
 * GI·∫¢I PH√ÅP:
 * - Hook n√†y qu·∫£n l√Ω to√†n b·ªô dark mode logic
 * - Persist v√†o localStorage v·ªõi key 'theme'
 * - Detect system preference n·∫øu ch∆∞a c√≥ localStorage
 * - Apply CSS class 'dark' v√†o document.documentElement
 * - Kh√¥ng duplicate logic ·ªü nhi·ªÅu n∆°i
 * 
 * T·∫°i sao ƒë√∫ng ki·∫øn tr√∫c:
 * - Single source of truth cho dark mode state
 * - Side effects (localStorage, CSS class) ƒë∆∞·ª£c qu·∫£n l√Ω t·∫≠p trung
 * - UI components ch·ªâ c·∫ßn consume state, kh√¥ng c·∫ßn bi·∫øt implementation
 * - D·ªÖ test (mock localStorage v√† matchMedia)
 * 
 * Production note:
 * - Consider useContext n·∫øu app ph·ª©c t·∫°p (tr√°nh prop drilling)
 * - Add transition classes ƒë·ªÉ animation m∆∞·ª£t
 * - Support multiple themes (light, dark, auto)
 */
function useDarkMode() {
  const [isDark, setIsDark] = useState(() => {
    // Priority: 1. localStorage, 2. system preference, 3. default light
    const stored = localStorage.getItem('theme');
    if (stored !== null) {
      return stored === 'dark';
    }
    
    // Check system preference
    if (window.matchMedia) {
      return window.matchMedia('(prefers-color-scheme: dark)').matches;
    }
    
    return false; // Default to light
  });
  
  useEffect(() => {
    // Apply theme to document
    if (isDark) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
    
    // Persist to localStorage
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  }, [isDark]);
  
  // Listen to system preference changes
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    
    const handleChange = (e) => {
      // Only apply system preference if user hasn't manually set theme
      const stored = localStorage.getItem('theme');
      if (!stored) {
        setIsDark(e.matches);
      }
    };
    
    // Modern browsers
    if (mediaQuery.addEventListener) {
      mediaQuery.addEventListener('change', handleChange);
      return () => mediaQuery.removeEventListener('change', handleChange);
    }
    // Legacy browsers
    else if (mediaQuery.addListener) {
      mediaQuery.addListener(handleChange);
      return () => mediaQuery.removeListener(handleChange);
    }
  }, []);
  
  const toggle = useCallback(() => {
    setIsDark(prev => !prev);
  }, []);
  
  return { isDark, toggle };
}

/**
 * Layer: Interaction
 * Hook: useAssessment
 * (unchanged from v1.0)
 */
const assessmentReducer = (state, action) => {
  switch (action.type) {
    case 'FETCH_QUESTIONS_START':
      return { ...state, status: 'loading', error: null };
    
    case 'FETCH_QUESTIONS_SUCCESS':
      return {
        ...state,
        status: 'questions_ready',
        questions: action.payload.questions,
        metadata: action.payload.metadata,
        currentIndex: 0,
        answers: []
      };
    
    case 'FETCH_QUESTIONS_ERROR':
      return { ...state, status: 'error', error: action.payload };
    
    case 'ANSWER_QUESTION':
      return {
        ...state,
        answers: [...state.answers, action.payload],
        currentIndex: state.currentIndex + 1
      };
    
    case 'ANALYZE_START':
      return { ...state, status: 'analyzing' };
    
    case 'ANALYZE_SUCCESS':
      return {
        ...state,
        status: 'completed',
        result: action.payload
      };
    
    case 'ANALYZE_ERROR':
      return { ...state, status: 'error', error: action.payload };
    
    case 'RESET':
      return initialAssessmentState;
    
    default:
      return state;
  }
};

const initialAssessmentState = {
  status: 'idle',
  questions: [],
  metadata: null,
  currentIndex: 0,
  answers: [],
  result: null,
  error: null
};

function useAssessment() {
  const [state, dispatch] = useReducer(assessmentReducer, initialAssessmentState);
  const abortControllerRef = useRef(null);
  
  const startAssessment = useCallback(async () => {
    dispatch({ type: 'FETCH_QUESTIONS_START' });
    
    try {
      const data = await BFFClient.fetchAssessmentQuestions();
      dispatch({ type: 'FETCH_QUESTIONS_SUCCESS', payload: data });
    } catch (error) {
      dispatch({ type: 'FETCH_QUESTIONS_ERROR', payload: error.message });
    }
  }, []);
  
  const answerQuestion = useCallback((questionId, answer) => {
    dispatch({
      type: 'ANSWER_QUESTION',
      payload: { questionId, ...answer }
    });
  }, []);
  
  const submitAssessment = useCallback(async () => {
    dispatch({ type: 'ANALYZE_START' });
    
    try {
      const result = await BFFClient.analyzeResults(state.answers);
      dispatch({ type: 'ANALYZE_SUCCESS', payload: result });
      return result;
    } catch (error) {
      dispatch({ type: 'ANALYZE_ERROR', payload: error.message });
      throw error;
    }
  }, [state.answers]);
  
  const reset = useCallback(() => {
    dispatch({ type: 'RESET' });
  }, []);
  
  useEffect(() => {
    return () => {
      if (abortControllerRef.current) {
        abortControllerRef.current.abort();
      }
    };
  }, []);
  
  return {
    state,
    startAssessment,
    answerQuestion,
    submitAssessment,
    reset,
    isComplete: state.currentIndex >= state.questions.length && state.questions.length > 0,
    progress: state.questions.length > 0 
      ? Math.round((state.currentIndex / state.questions.length) * 100)
      : 0
  };
}

/**
 * Layer: Interaction
 * Hook: useAIMentor
 * (unchanged from v1.0)
 */
function useAIMentor() {
  const [state, setState] = useState({
    status: 'idle',
    text: '',
    error: null
  });
  const isCancelledRef = useRef(false);
  
  const analyze = useCallback(async (assessmentResult) => {
    isCancelledRef.current = false;
    setState({ status: 'streaming', text: '', error: null });
    
    try {
      const { stream } = await BFFClient.streamAIAnalysis(assessmentResult);
      
      for await (const chunk of stream()) {
        if (isCancelledRef.current) break;
        setState(prev => ({ ...prev, text: chunk }));
      }
      
      if (!isCancelledRef.current) {
        setState(prev => ({ ...prev, status: 'completed' }));
      }
    } catch (error) {
      if (!isCancelledRef.current) {
        setState({ status: 'error', text: '', error: error.message });
      }
    }
  }, []);
  
  const cancel = useCallback(() => {
    isCancelledRef.current = true;
    setState({ status: 'idle', text: '', error: null });
  }, []);
  
  const reset = useCallback(() => {
    isCancelledRef.current = true;
    setState({ status: 'idle', text: '', error: null });
  }, []);
  
  useEffect(() => {
    return () => {
      isCancelledRef.current = true;
    };
  }, []);
  
  return { state, analyze, cancel, reset };
}

/**
 * Layer: Interaction
 * Hook: useResources
 * 
 * NEW v1.1: Qu·∫£n l√Ω resource fetching v√† filtering
 * 
 * Purpose: Orchestrate resource data flow
 * 
 * Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ:
 * - Fetch data from BFF layer
 * - Handle loading v√† error states
 * - Support filtering by subject
 * - Prevent unnecessary re-fetches
 * 
 * T·∫°i sao c·∫ßn hook ri√™ng:
 * - T√°ch business logic kh·ªèi UI
 * - D·ªÖ test logic ƒë·ªôc l·∫≠p
 * - C√≥ th·ªÉ reuse ·ªü nhi·ªÅu components
 * 
 * Pattern: useState + useEffect v·ªõi dependency array
 */
function useResources() {
  const [state, setState] = useState({
    status: 'idle', // idle | loading | success | error
    resources: [],
    metadata: null,
    error: null
  });
  
  const [filters, setFilters] = useState({
    subject: 'all'
  });
  
  const fetchResources = useCallback(async () => {
    setState(prev => ({ ...prev, status: 'loading', error: null }));
    
    try {
      const data = await BFFClient.fetchYouTubeResources(filters);
      setState({
        status: 'success',
        resources: data.resources,
        metadata: data.metadata,
        error: null
      });
    } catch (error) {
      setState({
        status: 'error',
        resources: [],
        metadata: null,
        error: error.message
      });
    }
  }, [filters]);
  
  // Fetch on mount v√† khi filters thay ƒë·ªïi
  useEffect(() => {
    fetchResources();
  }, [fetchResources]);
  
  const updateFilters = useCallback((newFilters) => {
    setFilters(prev => ({ ...prev, ...newFilters }));
  }, []);
  
  const retry = useCallback(() => {
    fetchResources();
  }, [fetchResources]);
  
  return {
    state,
    filters,
    updateFilters,
    retry
  };
}

// =============================================================================
// PRESENTATION LAYER - UI COMPONENTS
// =============================================================================

/**
 * Layer: Presentation
 * Component: Layout
 * 
 * FIX v1.1: Nh·∫≠n currentPage v√† onNavigate t·ª´ App (state lifting)
 * 
 * V·∫§N ƒê·ªÄ C≈®:
 * - NavLink c√≥ useState ri√™ng kh√¥ng sync v·ªõi App
 * - Duplicate state management
 * - Navigation kh√¥ng ho·∫°t ƒë·ªông ƒë√∫ng
 * 
 * GI·∫¢I PH√ÅP:
 * - App gi·ªØ single source of truth cho currentPage
 * - Layout nh·∫≠n currentPage v√† onNavigate qua props
 * - NavLink l√† pure component, ch·ªâ highlight active state
 * 
 * Props:
 * - children: React nodes to render
 * - darkMode: boolean (t·ª´ useDarkMode hook)
 * - onToggleDarkMode: function
 * - currentPage: string (t·ª´ App state)
 * - onNavigate: function (navigate handler t·ª´ App)
 */
function Layout({ children, darkMode, onToggleDarkMode, currentPage, onNavigate }) {
  return (
    <div className="min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200">
      <nav className="border-b border-gray-200 dark:border-gray-700">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-16">
            <div className="flex items-center gap-8">
              <h1 className="text-xl font-bold text-gray-900 dark:text-white">
                H·ªá Sinh Th√°i T·ª± H·ªçc S·ªë
              </h1>
              <div className="hidden md:flex gap-6">
                <NavLink 
                  to="home" 
                  isActive={currentPage === 'home'} 
                  onClick={onNavigate}
                >
                  Trang ch·ªß
                </NavLink>
                <NavLink 
                  to="assessment" 
                  isActive={currentPage === 'assessment'} 
                  onClick={onNavigate}
                >
                  ƒê√°nh gi√°
                </NavLink>
                <NavLink 
                  to="planner" 
                  isActive={currentPage === 'planner'} 
                  onClick={onNavigate}
                >
                  L·ªô tr√¨nh
                </NavLink>
                <NavLink 
                  to="resources" 
                  isActive={currentPage === 'resources'} 
                  onClick={onNavigate}
                >
                  T√†i nguy√™n
                </NavLink>
              </div>
            </div>
            
            <button
              onClick={onToggleDarkMode}
              className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              aria-label={darkMode ? 'Chuy·ªÉn sang ch·∫ø ƒë·ªô s√°ng' : 'Chuy·ªÉn sang ch·∫ø ƒë·ªô t·ªëi'}
            >
              {darkMode ? '‚òÄÔ∏è' : 'üåô'}
            </button>
          </div>
        </div>
      </nav>
      
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {children}
      </main>
    </div>
  );
}

/**
 * Layer: Presentation
 * Component: NavLink
 * 
 * FIX v1.1: Pure component, kh√¥ng c√≥ internal state
 * 
 * Props:
 * - to: string (page identifier)
 * - isActive: boolean (t·ª´ parent)
 * - onClick: function (handler t·ª´ parent)
 * - children: React nodes
 */
function NavLink({ to, isActive, onClick, children }) {
  const handleClick = () => {
    onClick(to);
  };
  
  return (
    <button
      onClick={handleClick}
      className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${
        isActive
          ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200'
          : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'
      }`}
    >
      {children}
    </button>
  );
}

/**
 * Layer: Presentation
 * Component: AssessmentCard
 * (unchanged from v1.0)
 */
function AssessmentCard({ question, onAnswer, questionNumber, totalQuestions }) {
  const [selected, setSelected] = useState(null);
  
  const handleSelect = (option) => {
    setSelected(option);
  };
  
  const handleSubmit = () => {
    if (selected) {
      onAnswer(question.id, selected);
      setSelected(null);
    }
  };
  
  return (
    <div 
      className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 max-w-2xl mx-auto"
      role="article"
      aria-labelledby={`question-${question.id}`}
    >
      <div className="mb-6">
        <div className="flex justify-between items-center mb-4">
          <span className="text-sm font-medium text-gray-500 dark:text-gray-400">
            C√¢u {questionNumber} / {totalQuestions}
          </span>
          <span className="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300">
            {question.subject}
          </span>
        </div>
        
        <h2 
          id={`question-${question.id}`}
          className="text-xl font-semibold text-gray-900 dark:text-white"
        >
          {question.text}
        </h2>
      </div>
      
      <div className="space-y-3 mb-6" role="radiogroup" aria-labelledby={`question-${question.id}`}>
        {question.options.map((option) => (
          <button
            key={option.id}
            onClick={() => handleSelect(option)}
            className={`w-full text-left p-4 rounded-lg border-2 transition-all ${
              selected?.id === option.id
                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/30 dark:border-blue-400'
                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'
            }`}
            role="radio"
            aria-checked={selected?.id === option.id}
          >
            <div className="flex items-start gap-3">
              <div className={`mt-0.5 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                selected?.id === option.id
                  ? 'border-blue-500 dark:border-blue-400'
                  : 'border-gray-300 dark:border-gray-600'
              }`}>
                {selected?.id === option.id && (
                  <div className="w-3 h-3 rounded-full bg-blue-500 dark:bg-blue-400" />
                )}
              </div>
              <span className="text-gray-700 dark:text-gray-300">{option.text}</span>
            </div>
          </button>
        ))}
      </div>
      
      <button
        onClick={handleSubmit}
        disabled={!selected}
        className="w-full py-3 px-6 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-blue-600 hover:bg-blue-700 text-white"
      >
        Ti·∫øp t·ª•c
      </button>
    </div>
  );
}

/**
 * Layer: Presentation
 * Component: ResultsDashboard
 * (unchanged from v1.0)
 */
function ResultsDashboard({ result, onStartAI }) {
  const { scores, strengths, weaknesses, recommendations } = result;
  
  const getScoreColor = (score) => {
    if (score >= 70) return 'bg-green-500 dark:bg-green-600';
    if (score >= 50) return 'bg-yellow-500 dark:bg-yellow-600';
    return 'bg-red-500 dark:bg-red-600';
  };
  
  const getScoreTextColor = (score) => {
    if (score >= 70) return 'text-green-700 dark:text-green-300';
    if (score >= 50) return 'text-yellow-700 dark:text-yellow-300';
    return 'text-red-700 dark:text-red-300';
  };
  
  return (
    <div className="max-w-4xl mx-auto space-y-6">
      <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
        <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">
          K·∫øt qu·∫£ ƒë√°nh gi√° nƒÉng l·ª±c t·ª± h·ªçc
        </h2>
        
        <div className="space-y-4 mb-8">
          {Object.entries(scores).map(([key, score]) => (
            <div key={key}>
              <div className="flex justify-between items-center mb-2">
                <span className="text-sm font-medium text-gray-700 dark:text-gray-300">
                  {getScoreLabel(key)}
                </span>
                <span className={`text-sm font-bold ${getScoreTextColor(score)}`}>
                  {score}/100
                </span>
              </div>
              <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div
                  className={`h-2 rounded-full transition-all duration-500 ${getScoreColor(score)}`}
                  style={{ width: `${score}%` }}
                />
              </div>
            </div>
          ))}
        </div>
        
        {strengths.length > 0 && (
          <div className="mb-6">
            <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <span>üí™</span> ƒêi·ªÉm m·∫°nh
            </h3>
            <div className="space-y-3">
              {strengths.map((strength, idx) => (
                <div key={idx} className="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                  <div className="font-medium text-green-900 dark:text-green-300 mb-1">
                    {strength.area}
                  </div>
                  <div className="text-sm text-green-700 dark:text-green-400">
                    {strength.description}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
        
        {weaknesses.length > 0 && (
          <div className="mb-6">
            <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <span>üéØ</span> C·∫ßn c·∫£i thi·ªán
            </h3>
            <div className="space-y-3">
              {weaknesses.map((weakness, idx) => (
                <div key={idx} className="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                  <div className="font-medium text-yellow-900 dark:text-yellow-300 mb-1">
                    {weakness.area}
                  </div>
                  <div className="text-sm text-yellow-700 dark:text-yellow-400">
                    {weakness.description}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
        
        {recommendations.length > 0 && (
          <div className="mb-6">
            <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <span>üìã</span> G·ª£i √Ω h√†nh ƒë·ªông
            </h3>
            <div className="space-y-3">
              {recommendations.map((rec, idx) => (
                <div key={idx} className="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                  <div className="flex items-start gap-3">
                    <span className="flex-shrink-0 w-6 h-6 rounded-full bg-blue-500 dark:bg-blue-600 text-white text-sm flex items-center justify-center font-medium">
                      {idx + 1}
                    </span>
                    <div className="flex-1">
                      <div className="text-sm text-blue-900 dark:text-blue-300 mb-1">
                        {rec.action}
                      </div>
                      <div className="text-xs text-blue-700 dark:text-blue-400">
                        Th·ªùi gian: {rec.timeframe}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
        
        <div className="mt-8 p-6 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
          <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2">
            <span>ü§ñ</span> AI Mentor c·ªßa em
          </h3>
          <p className="text-sm text-gray-700 dark:text-gray-300 mb-4">
            ƒê·ªÉ hi·ªÉu s√¢u h∆°n v·ªÅ k·∫øt qu·∫£ v√† nh·∫≠n t∆∞ v·∫•n c√° nh√¢n h√≥a, h√£y tr√≤ chuy·ªán v·ªõi AI Mentor nh√©!
          </p>
          <button
            onClick={onStartAI}
            className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors"
          >
            Tr√≤ chuy·ªán v·ªõi AI Mentor
          </button>
        </div>
      </div>
    </div>
  );
}

function getScoreLabel(key) {
  const labels = {
    metacognition: 'T∆∞ duy si√™u nh·∫≠n th·ª©c',
    autonomy: 'T√≠nh t·ª± ch·ªß',
    criticalThinking: 'T∆∞ duy ph·∫£n bi·ªán',
    aiLiteracy: 'NƒÉng l·ª±c AI',
    growthMindset: 'T∆∞ duy ph√°t tri·ªÉn'
  };
  return labels[key] || key;
}

/**
 * Layer: Presentation
 * Component: AIMentorChat
 * (unchanged from v1.0)
 */
function AIMentorChat({ isOpen, onClose, result, aiState, onStartAnalysis }) {
  const modalRef = useRef(null);
  
  useEffect(() => {
    if (isOpen) {
      onStartAnalysis(result);
      modalRef.current?.focus();
      
      const handleEscape = (e) => {
        if (e.key === 'Escape') onClose();
      };
      document.addEventListener('keydown', handleEscape);
      
      return () => {
        document.removeEventListener('keydown', handleEscape);
      };
    }
  }, [isOpen, result, onStartAnalysis]);
  
  if (!isOpen) return null;
  
  return (
    <div 
      className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"
      onClick={onClose}
    >
      <div
        ref={modalRef}
        className="bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden"
        onClick={(e) => e.stopPropagation()}
        role="dialog"
        aria-labelledby="ai-mentor-title"
        aria-modal="true"
        tabIndex={-1}
      >
        <div className="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
          <h2 id="ai-mentor-title" className="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
            <span>ü§ñ</span> AI Mentor
          </h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
            aria-label="ƒê√≥ng"
          >
            ‚úï
          </button>
        </div>
        
        <div className="p-6 overflow-y-auto max-h-[60vh]">
          {aiState.status === 'streaming' && (
            <div className="mb-4 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
              <div className="animate-pulse">‚óè</div>
              <span>AI Mentor ƒëang vi·∫øt...</span>
            </div>
          )}
          
          {aiState.status === 'error' && (
            <div className="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400">
              C√≥ l·ªói x·∫£y ra: {aiState.error}
            </div>
          )}
          
          {aiState.text && (
            <div className="prose dark:prose-invert max-w-none">
              <p className="text-gray-700 dark:text-gray-300 whitespace-pre-line">
                {aiState.text}
              </p>
            </div>
          )}
          
          {aiState.status === 'completed' && (
            <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
              <h3 className="font-semibold text-blue-900 dark:text-blue-300 mb-2">
                B∆∞·ªõc ti·∫øp theo
              </h3>
              <ul className="space-y-2 text-sm text-blue-700 dark:text-blue-400">
                {result.nextSteps.map((step, idx) => (
                  <li key={idx} className="flex items-start gap-2">
                    <span>‚Üí</span>
                    <span>{step}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
        
        <div className="p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3">
          <button
            onClick={onClose}
            className="px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
          >
            ƒê√≥ng
          </button>
        </div>
      </div>
    </div>
  );
}

/**
 * Layer: Presentation
 * Component: ResourceCard
 * 
 * NEW v1.1: Display YouTube channel resource
 * 
 * Props:
 * - resource: object { name, description, thumbnail, url, subject, verified, subscribers }
 * 
 * Pure presentational component
 * Accessibility: Link v·ªõi proper aria-label
 */
function ResourceCard({ resource }) {
  const subjectLabels = {
    math: 'To√°n',
    physics: 'V·∫≠t l√Ω',
    chemistry: 'H√≥a h·ªçc',
    biology: 'Sinh h·ªçc',
    english: 'Ti·∫øng Anh',
    history: 'L·ªãch s·ª≠',
    geography: 'ƒê·ªãa l√Ω',
    literature: 'VƒÉn h·ªçc',
    general: 'T·ªïng h·ª£p',
    critical_thinking: 'T∆∞ duy'
  };
  
  return (
    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow overflow-hidden">
      <div className="relative">
        <img
          src={resource.thumbnail}
          alt={`${resource.name} thumbnail`}
          className="w-full h-48 object-cover"
          loading="lazy"
        />
        {resource.verified && (
          <div className="absolute top-2 right-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1">
            <span>‚úì</span>
            <span>ƒê√£ ki·ªÉm duy·ªát</span>
          </div>
        )}
      </div>
      
      <div className="p-6">
        <div className="flex items-start justify-between mb-2">
          <h3 className="text-lg font-semibold text-gray-900 dark:text-white">
            {resource.name}
          </h3>
          <span className="px-2 py-1 text-xs rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
            {subjectLabels[resource.subject] || resource.subject}
          </span>
        </div>
        
        <p className="text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-3">
          {resource.description}
        </p>
        
        <div className="flex items-center justify-between">
          <span className="text-xs text-gray-500 dark:text-gray-500">
            {resource.subscribers} subscribers
          </span>
          
          <a
            href={resource.url}
            target="_blank"
            rel="noopener noreferrer"
            className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-lg transition-colors flex items-center gap-2"
            aria-label={`Xem k√™nh ${resource.name} tr√™n YouTube`}
          >
            <span>‚ñ∂</span>
            <span>Xem k√™nh</span>
          </a>
        </div>
      </div>
    </div>
  );
}

// =============================================================================
// PAGES
// =============================================================================

/**
 * Page: Home
 * (unchanged from v1.0)
 */
function HomePage({ onNavigate }) {
  return (
    <div className="space-y-12">
      <section className="text-center py-16">
        <h1 className="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6">
          X√¢y d·ª±ng nƒÉng l·ª±c t·ª± h·ªçc
          <br />
          <span className="text-blue-600 dark:text-blue-400">cho th·∫ø h·ªá AI</span>
        </h1>
        <p className="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-8">
          Kh√¥ng ch·ªâ n√¢ng cao k·∫øt qu·∫£ h·ªçc t·∫≠p, m√† ph√°t tri·ªÉn kh·∫£ nƒÉng t·ª± ch·ªß h·ªçc t·∫≠p l√¢u d√†i
          trong b·ªëi c·∫£nh c√¥ng ngh·ªá AI ph·ªï bi·∫øn.
        </p>
        <button
          onClick={() => onNavigate('assessment')}
          className="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-lg transition-colors"
        >
          B·∫Øt ƒë·∫ßu ƒë√°nh gi√° nƒÉng l·ª±c ‚Üí
        </button>
      </section>
      
      <section className="grid md:grid-cols-3 gap-8">
        <FeatureCard
          icon="üìä"
          title="ƒê√°nh gi√° nƒÉng l·ª±c"
          description="Kh√°m ph√° ƒëi·ªÉm m·∫°nh v√† khu v·ª±c c·∫ßn ph√°t tri·ªÉn v·ªÅ nƒÉng l·ª±c t·ª± h·ªçc c·ªßa b·∫°n"
        />
        <FeatureCard
          icon="üó∫Ô∏è"
          title="L·ªô tr√¨nh c√° nh√¢n"
          description="L·ªô tr√¨nh h·ªçc t·∫≠p ƒë∆∞·ª£c thi·∫øt k·∫ø ri√™ng d·ª±a tr√™n k·∫øt qu·∫£ ƒë√°nh gi√°"
        />
        <FeatureCard
          icon="üìö"
          title="T√†i nguy√™n ƒë√£ ki·ªÉm duy·ªát"
          description="Kho t√†i li·ªáu ch·∫•t l∆∞·ª£ng cao ƒë∆∞·ª£c gi√°o vi√™n v√† chuy√™n gia x√°c minh"
        />
      </section>
    </div>
  );
}

function FeatureCard({ icon, title, description }) {
  return (
    <div className="p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow">
      <div className="text-4xl mb-4">{icon}</div>
      <h3 className="text-xl font-semibold text-gray-900 dark:text-white mb-2">
        {title}
      </h3>
      <p className="text-gray-600 dark:text-gray-400">
        {description}
      </p>
    </div>
  );
}

/**
 * Page: Assessment
 * (unchanged from v1.0)
 */
function AssessmentPage() {
  const {
    state,
    startAssessment,
    answerQuestion,
    submitAssessment,
    reset,
    isComplete,
    progress
  } = useAssessment();
  
  const {
    state: aiState,
    analyze: analyzeWithAI,
    cancel: cancelAI,
    reset: resetAI
  } = useAIMentor();
  
  const [showAIModal, setShowAIModal] = useState(false);
  
  const handleStartAI = (result) => {
    setShowAIModal(true);
  };
  
  const handleCloseAI = () => {
    setShowAIModal(false);
    resetAI();
  };
  
  useEffect(() => {
    if (isComplete && state.status === 'questions_ready') {
      submitAssessment();
    }
  }, [isComplete, state.status, submitAssessment]);
  
  if (state.status === 'idle') {
    return (
      <div className="max-w-2xl mx-auto text-center py-16">
        <div className="text-6xl mb-6">üìä</div>
        <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-4">
          ƒê√°nh gi√° nƒÉng l·ª±c t·ª± h·ªçc
        </h1>
        <p className="text-lg text-gray-600 dark:text-gray-400 mb-8">
          12 c√¢u h·ªèi gi√∫p b·∫°n hi·ªÉu r√µ h∆°n v·ªÅ kh·∫£ nƒÉng t·ª± ch·ªß h·ªçc t·∫≠p c·ªßa m√¨nh.
          Kh√¥ng c√≥ ƒë√∫ng sai, ch·ªâ c√≥ ph√π h·ª£p v·ªõi con ng∆∞·ªùi b·∫°n.
        </p>
        <div className="mb-8 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 text-left">
          <h3 className="font-semibold text-blue-900 dark:text-blue-300 mb-3">
            B·∫°n s·∫Ω ƒë∆∞·ª£c ƒë√°nh gi√° v·ªÅ:
          </h3>
          <ul className="space-y-2 text-blue-700 dark:text-blue-400">
            <li>‚Ä¢ T∆∞ duy si√™u nh·∫≠n th·ª©c (Metacognition)</li>
            <li>‚Ä¢ T√≠nh t·ª± ch·ªß trong h·ªçc t·∫≠p</li>
            <li>‚Ä¢ Kh·∫£ nƒÉng t∆∞ duy ph·∫£n bi·ªán</li>
            <li>‚Ä¢ NƒÉng l·ª±c s·ª≠ d·ª•ng AI hi·ªáu qu·∫£</li>
            <li>‚Ä¢ T∆∞ duy ph√°t tri·ªÉn (Growth Mindset)</li>
          </ul>
        </div>
        <button
          onClick={startAssessment}
          className="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-lg transition-colors"
        >
          B·∫Øt ƒë·∫ßu ngay
        </button>
      </div>
    );
  }
  
  if (state.status === 'loading') {
    return (
      <div className="flex flex-col items-center justify-center py-16">
        <div className="animate-spin text-6xl mb-4">‚öôÔ∏è</div>
        <p className="text-gray-600 dark:text-gray-400">ƒêang chu·∫©n b·ªã c√¢u h·ªèi...</p>
      </div>
    );
  }
  
  if (state.status === 'questions_ready' && !isComplete) {
    const currentQuestion = state.questions[state.currentIndex];
    
    return (
      <div className="space-y-6">
        <div className="max-w-2xl mx-auto">
          <div className="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2">
            <span>Ti·∫øn ƒë·ªô</span>
            <span>{progress}%</span>
          </div>
          <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
            <div
              className="bg-blue-600 dark:bg-blue-500 h-2 rounded-full transition-all duration-300"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>
        
        <AssessmentCard
          question={currentQuestion}
          onAnswer={answerQuestion}
          questionNumber={state.currentIndex + 1}
          totalQuestions={state.questions.length}
        />
      </div>
    );
  }
  
  if (state.status === 'analyzing') {
    return (
      <div className="flex flex-col items-center justify-center py-16">
        <div className="animate-pulse text-6xl mb-4">üß†</div>
        <p className="text-xl text-gray-900 dark:text-white font-medium mb-2">
          ƒêang ph√¢n t√≠ch k·∫øt qu·∫£...
        </p>
        <p className="text-gray-600 dark:text-gray-400">
          AI ƒëang x·ª≠ l√Ω c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n
        </p>
      </div>
    );
  }
  
  if (state.status === 'completed' && state.result) {
    return (
      <>
        <ResultsDashboard
          result={state.result}
          onStartAI={handleStartAI}
        />
        
        <AIMentorChat
          isOpen={showAIModal}
          onClose={handleCloseAI}
          result={state.result}
          aiState={aiState}
          onStartAnalysis={analyzeWithAI}
        />
        
        <div className="max-w-4xl mx-auto mt-8 text-center">
          <button
            onClick={reset}
            className="px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors"
          >
            L√†m l·∫°i ƒë√°nh gi√°
          </button>
        </div>
      </>
    );
  }
  
  if (state.status === 'error') {
    return (
      <div className="max-w-2xl mx-auto text-center py-16">
        <div className="text-6xl mb-6">‚ö†Ô∏è</div>
        <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">
          C√≥ l·ªói x·∫£y ra
        </h2>
        <p className="text-gray-600 dark:text-gray-400 mb-8">
          {state.error}
        </p>
        <button
          onClick={reset}
          className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors"
        >
          Th·ª≠ l·∫°i
        </button>
      </div>
    );
  }
  
  return null;
}

/**
 * Page: Learning Planner
 * Status: MOCK
 * (unchanged from v1.0)
 */
function LearningPlannerPage() {
  return (
    <div className="max-w-4xl mx-auto">
      <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-8">
        L·ªô tr√¨nh h·ªçc t·∫≠p c√° nh√¢n
      </h1>
      
      <div className="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6 mb-8">
        <div className="flex items-start gap-3">
          <span className="text-2xl">üöß</span>
          <div>
            <h3 className="font-semibold text-yellow-900 dark:text-yellow-300 mb-2">
              Module ƒëang ph√°t tri·ªÉn
            </h3>
            <p className="text-sm text-yellow-700 dark:text-yellow-400 mb-3">
              Ch·ª©c nƒÉng n√†y hi·ªán ƒëang ·ªü d·∫°ng mock. Production implementation s·∫Ω bao g·ªìm:
            </p>
            <ul className="text-sm text-yellow-700 dark:text-yellow-400 space-y-1">
              <li>‚Ä¢ T·∫°o l·ªô tr√¨nh d·ª±a tr√™n k·∫øt qu·∫£ ƒë√°nh gi√°</li>
              <li>‚Ä¢ Personalized milestones theo tu·∫ßn/th√°ng</li>
              <li>‚Ä¢ Spaced repetition schedule</li>
              <li>‚Ä¢ Progress tracking v·ªõi data visualization</li>
              <li>‚Ä¢ Adaptive recommendations khi ho√†n th√†nh m·ª•c ti√™u</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div className="grid md:grid-cols-2 gap-6">
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
          <h3 className="font-semibold text-gray-900 dark:text-white mb-4">
            M·ª•c ti√™u th√°ng n√†y
          </h3>
          <div className="space-y-3">
            {['C·∫£i thi·ªán t∆∞ duy ph·∫£n bi·ªán', 'Th·ª±c h√†nh learning log', 'Ho√†n th√†nh 5 b√†i t·∫≠p t·ª± gi·∫£i'].map((goal, idx) => (
              <div key={idx} className="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded">
                <input type="checkbox" className="w-5 h-5" />
                <span className="text-gray-700 dark:text-gray-300">{goal}</span>
              </div>
            ))}
          </div>
        </div>
        
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
          <h3 className="font-semibold text-gray-900 dark:text-white mb-4">
            L·ªãch h·ªçc tu·∫ßn n√†y
          </h3>
          <p className="text-sm text-gray-500 dark:text-gray-400">
            Coming soon...
          </p>
        </div>
      </div>
    </div>
  );
}

/**
 * Page: Resources
 * 
 * STATUS: FULL IMPLEMENTATION v1.1
 * 
 * NEW: Real YouTube education channels
 * NEW: useResources hook integration
 * NEW: Subject filtering
 * NEW: ResourceCard component
 * 
 * Data flow:
 * 1. useResources hook fetch t·ª´ BFF
 * 2. BFF tr·∫£ normalized YouTube channel data
 * 3. Page render loading/error/success states
 * 4. User filter by subject ‚Üí hook re-fetch
 * 5. Cards display v·ªõi external links
 */
function ResourcesPage() {
  const { state, filters, updateFilters, retry } = useResources();
  
  const subjectOptions = [
    { value: 'all', label: 'T·∫•t c·∫£ m√¥n h·ªçc' },
    { value: 'math', label: 'To√°n' },
    { value: 'physics', label: 'V·∫≠t l√Ω' },
    { value: 'chemistry', label: 'H√≥a h·ªçc' },
    { value: 'biology', label: 'Sinh h·ªçc' },
    { value: 'english', label: 'Ti·∫øng Anh' },
    { value: 'history', label: 'L·ªãch s·ª≠' },
    { value: 'geography', label: 'ƒê·ªãa l√Ω' },
    { value: 'literature', label: 'VƒÉn h·ªçc' },
    { value: 'general', label: 'T·ªïng h·ª£p' },
    { value: 'critical_thinking', label: 'T∆∞ duy' }
  ];
  
  return (
    <div className="max-w-6xl mx-auto">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Kho t√†i nguy√™n h·ªçc t·∫≠p
        </h1>
        <p className="text-gray-600 dark:text-gray-400">
          C√°c k√™nh YouTube gi√°o d·ª•c ƒë√£ ƒë∆∞·ª£c ki·ªÉm duy·ªát b·ªüi gi√°o vi√™n v√† chuy√™n gia
        </p>
      </div>
      
      {/* Filter */}
      <div className="mb-6 flex gap-4">
        <select
          value={filters.subject}
          onChange={(e) => updateFilters({ subject: e.target.value })}
          className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          {subjectOptions.map(option => (
            <option key={option.value} value={option.value}>
              {option.label}
            </option>
          ))}
        </select>
        
        {state.metadata && (
          <div className="flex items-center text-sm text-gray-600 dark:text-gray-400">
            <span>{state.metadata.total} k√™nh</span>
          </div>
        )}
      </div>
      
      {/* Loading state */}
      {state.status === 'loading' && (
        <div className="flex flex-col items-center justify-center py-16">
          <div className="animate-spin text-4xl mb-4">‚öôÔ∏è</div>
          <p className="text-gray-600 dark:text-gray-400">ƒêang t·∫£i t√†i nguy√™n...</p>
        </div>
      )}
      
      {/* Error state */}
      {state.status === 'error' && (
        <div className="max-w-2xl mx-auto text-center py-16">
          <div className="text-6xl mb-6">‚ö†Ô∏è</div>
          <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">
            Kh√¥ng th·ªÉ t·∫£i t√†i nguy√™n
          </h2>
          <p className="text-gray-600 dark:text-gray-400 mb-8">
            {state.error}
          </p>
          <button
            onClick={retry}
            className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors"
          >
            Th·ª≠ l·∫°i
          </button>
        </div>
      )}
      
      {/* Success state */}
      {state.status === 'success' && (
        <>
          {state.resources.length === 0 ? (
            <div className="text-center py-16">
              <div className="text-6xl mb-4">üìö</div>
              <p className="text-gray-600 dark:text-gray-400">
                Kh√¥ng t√¨m th·∫•y t√†i nguy√™n n√†o ph√π h·ª£p
              </p>
            </div>
          ) : (
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {state.resources.map(resource => (
                <ResourceCard key={resource.id} resource={resource} />
              ))}
            </div>
          )}
        </>
      )}
    </div>
  );
}

// =============================================================================
// APP ROOT
// =============================================================================

/**
 * Root App Component
 * 
 * FIX v1.1: Refactored state management
 * 
 * V·∫§N ƒê·ªÄ C≈®:
 * - Dark mode hook ƒë∆∞·ª£c g·ªçi nh∆∞ng kh√¥ng pass xu·ªëng Layout ƒë√∫ng c√°ch
 * - Navigation state kh√¥ng r√µ r√†ng
 * - NavLink c√≥ state ri√™ng kh√¥ng sync
 * 
 * GI·∫¢I PH√ÅP:
 * - App gi·ªØ single source of truth cho currentPage
 * - useDarkMode hook tr·∫£ v·ªÅ { isDark, toggle }
 * - Pass c·∫£ 4 props xu·ªëng Layout: darkMode, onToggleDarkMode, currentPage, onNavigate
 * - Layout pass currentPage v√† onNavigate xu·ªëng NavLink
 * - Kh√¥ng duplicate state ·ªü b·∫•t k·ª≥ ƒë√¢u
 * 
 * Responsibilities:
 * - Global state management (dark mode, routing)
 * - Route rendering
 * - Pass state v√† handlers xu·ªëng components
 * 
 * Production notes:
 * - Replace v·ªõi React Router cho proper routing
 * - Add authentication context
 * - Add error boundary
 * - Add analytics tracking
 */
function App() {
  const { isDark, toggle } = useDarkMode();
  const [currentPage, setCurrentPage] = useState('home');
  
  const handleNavigate = useCallback((page) => {
    setCurrentPage(page);
    // Scroll to top on navigation
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }, []);
  
  const renderPage = () => {
    switch (currentPage) {
      case 'home':
        return <HomePage onNavigate={handleNavigate} />;
      case 'assessment':
        return <AssessmentPage />;
      case 'planner':
        return <LearningPlannerPage />;
      case 'resources':
        return <ResourcesPage />;
      default:
        return <HomePage onNavigate={handleNavigate} />;
    }
  };
  
  return (
    <Layout 
      darkMode={isDark}
      onToggleDarkMode={toggle}
      currentPage={currentPage}
      onNavigate={handleNavigate}
    >
      {renderPage()}
    </Layout>
  );
}

export default App;